
db.student.find()

db.faculty.insertOne({
    name:"faculty of science",
    city:"giza"
})

db.faculty.find()

db.student.aggregate({$match:{}})

db.courses.insertMany([
{name:"node" , grade:100},
{name:"math1" , grade:50},
{name:"math2" , grade:99},
{name:"algebra" , grade:90},
{name:"cs1" , grade:70},
{name:"software" , grade:80},
{name:"database" , grade:90}
])

//1
db.courses.aggregate([{ $group: { _id: "$name" ,total:  {$sum: "$grade"} }}])

//2
db.student.aggregate([{$group :{_id : null , count :{$sum:1}} }])

//3  

db.student.insertOne({
    fname:"hany",
    lname:"fawzy",
    age:30,
    courses:[
    {name:"nodejs" , grade:200},
    {name:"angular" ,grade:200}
    ]
    
})

db.student.find({fname:"hany"} ,{courses:1})

// 4 


db.student.insertOne({
    fname:"tarek",
    lname:"mohamed",
    age:30,
    fid:ObjectId("68aef5c6aa5e88fde789b04a"),
})

db.student.find({fname:"tarek"} ,{fid:1})


// 5

db.student.update({fname:"tarek"} ,{$set:{ fid :[{$id :ObjectId("68aef5c6aa5e88fde789b04a") ,$ref:"faculty" } ] }})

db.student.find({fname:"tarek"} ,{fid:1})


// 6
db.faculty.createIndex({ name: 1 }, { unique: true })

// 1

db.students.insertMany([
{name:"malak" , courses :[
    {name:"node" , mark:100},
    {name:"express" , mark:120}
    ]},
{name:"ali" ,courses:[
    {name:"express", mark:120},
    {name:"anguler" ,mark:100}
    ]}
])


db.students.mapReduce(
function(){
    this.courses.forEach(e =>{
        emit(this.name ,e.mark);
    })
},
function (k ,v){
    return Array.sum(v);
},
{
    out:"totalMarks"
}
)

db.totalMarks.find()

// 2

db.student.aggregate([
{$group : {_id:"faculty.name" , count :{$sum : 1 }}
}
])
